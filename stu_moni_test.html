<!doctype html>
<html lang="en" class="fixed">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <title>三门核电有限公司三门数字化仿真检修平台</title>
    <link rel="stylesheet" type="text/css" href="stylesheets/css/bootstrap-3.3.4.css">
    <link rel="stylesheet" type="text/css" href="stylesheets/css/font-awesome.min.css">
    <link rel="stylesheet" href="stylesheets/css/vendor/animate.css/animate.css">
    <link rel="stylesheet" href="stylesheets/css/style.css">
    <link rel="stylesheet" href="stylesheets/css/oeinsder.css">
    <link rel="stylesheet" href="stylesheets/css/subject.css">
    <link rel="stylesheet" href="stylesheets/css/question-bank.css">


</head>
<style>
    .section-body {
        margin-bottom: 30px;
    }

    .btn.btn-wide {
        margin-bottom: -15px;
        margin-left: 10px;
    }

    #basic-table_length, #basic-table_filter {
        display: none;
    }

    .section-foot {
        display: none;
    }
</style>
<!--[if lt IE 8]>
<script type="text/javascript" src="javascripts/html5.js"></script>
<script type="text/javascript" src="javascripts/respond.js"></script>
<![endif]-->
<body>
<!--记载过程中的loading-->
<div class="text-center">
<span class='text-center shuju-tishi shuju-tishi1' style='color:white;display: none;'>
</span>
    <span class='text-center shuju-tishi shuju-tishi2' style='background-color:red;color:white;display: none;'>
</span>
</div>

<!--导航条-->
<nav class="navbar navbar-default">
    <div class="container-fluid">
        <div class="navbar-header">
            <!--汉堡菜单-->
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                    data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
        </div>

        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav">
                <li><a href="stu_model_read.html" title='模型浏览'>模型浏览</a></li>
                <li><a class="selects_top" href="oeinsder.html" title='考核培训'>考核培训</a></li>
                <li><a href="stu_xiu.html" title='检修规划'>检修规划</a></li>
                <li><a href="stu_usname.html" title='你好' class="usname_local" onload="loginas()">你好</a></li>
                <li><a href="stu_student.html" title='通知'><i class="fa fa-bell"></i></a></li>
                <li><a href="login.html" title='注销'><i class="fa fa-sign-out" style='margin-right: 7px;'></i>注销</a></li>
            </ul>
        </div>
    </div>
</nav>
<!--底部栏-->
<div class="content">
    <div>
        <div class="container-fluid banner-fal">
            <ul class="banner_top clearfix">
                <li><a href="oeinsder.html" title="课程学习">课程学习</a></li>
                <li><a href="stu_student.html" title='在线考试'>在线考试</a></li>
                <li><a href="stu_moni_test.html" class="select" title='模拟考试'>模拟考试</a></li>
                <li><a href="stu_history_test.html" title='成绩查看'>成绩查看</a></li>
                <li class="pull-right"><a href="stu_download.html" title='软件下载'>软件下载</a></li>
            </ul>
        </div>
        <div class="peinsder-box">
            <div class="container-fluid peinsder-sb">
                设备
            </div>
            <!--显示课程设备学习图解-->
            <div class="container-fluid">
                <div class=" animated fadeInRight">

                    <div class="section-body clearfix">
                        <!--主体结构-->
                        <div>
                            设备
                            <select name="" id="facility">
                                <option value="">请选择设备</option>
                                <option value="1">爆破阀</option>
                            </select>
                            课程
                            <select name="" id="curriculum">
                                <option value="">请选择相应的课程</option>
                                <option value="2">课程</option>
                            </select>
                        </div>
                        <button id="test_button" class=" btn btn-wide btn-success" title='抽取模拟试卷'>抽取模拟试卷</button>
                    </div>
                    <div class=" clearfix">
                        <!--表格数据-->
                        <table id="basic-table"
                               class="data-table table table-striped nowrap table-hover" cellspacing="0"
                               width="100%">
                            <thead>
                            <tr>
                                <th>标识</th>
                                <th>试卷名称</th>
                                <th>姓名</th>
                                <th>操作题得分</th>
                                <th>选择题得分(每题5分)</th>
                                <th>抽取时间</th>
                                <th>完成时间</th>
                                <th>操作</th>
                            </tr>
                            </thead>
                            <tbody class="tbodya">
                            <!--占位符-->
                            </tbody>
                        </table>
                        <div class="section-foot">
                            没有可选的模拟试卷，请抽取模拟试卷。
                            <button type="button" class="close" id="select-close"><span>×</span><span
                                    class="sr-only">Close</span>
                            </button>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

<!--警告信息-->
<div class="modal fade" id="error-modal2" tabindex="-1" role="dialog"
     aria-labelledby="modal-error-label"
     style="display: none;">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header state modal-warning">
                <button type="button" class="close" data-dismiss="modal"
                        aria-label="Close"><span
                        aria-hidden="true">×</span></button>
                <h4 class="modal-title"><i class="fa fa-warning"></i>提示
                </h4>
            </div>
            <div class="modal-body">
                <span></span>请先选择设备及课程
            </div>
            <div class="modal-footer">
                <!--确认删除-->
                <button type="button" class="btn " data-dismiss="modal">
                    确定
                </button>
            </div>
        </div>
    </div>
</div>

<!--警告信息-->
<div class="modal fade" id="error-modal" tabindex="-1" role="dialog"
     aria-labelledby="modal-error-label"
     style="display: none;">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header state modal-warning">
                <button type="button" class="close" data-dismiss="modal"
                        aria-label="Close"><span
                        aria-hidden="true">×</span></button>
                <h4 class="modal-title"><i class="fa fa-warning"></i>提示
                </h4>
            </div>
            <div class="modal-body">
                <span class="error-span1">课程没有可选的模拟试题,请联系教员</span>
            </div>
            <div class="modal-footer">
                <!--确认删除-->
                <button type="button" class="btn " data-dismiss="modal">
                    确定
                </button>
            </div>
        </div>
    </div>
</div>
<!--向上按钮-->
<a href="#" class="scroll-to-top"><i class="fa fa-angle-double-up"></i></a>
</body>
<script src="javascripts/jquery.1.10.2.js"></script>
<script src="stylesheets/css/vendor/bootstrap/js/bootstrap.min.js"></script>
<script src="javascripts/peinsder.js"></script>
<script src="stylesheets/css/vendor/media/js/jquery.dataTables.min.js"></script>
<script src="stylesheets/css/vendor/media/js/dataTables.bootstrap.min.js"></script>
<script src='javascripts/course.js'></script>
<script type="text/javascript" src='javascripts/sea.js'></script>
<script type="text/javascript">
    seajs.use('./javascripts/common.js', function (main) {
        var ace = new main.comm();
        var mo = new models();
        //隐藏栏目
        ace.select_but.click(function () {
            $(this).parent().slideUp();
        });

        var fac = [];
        var course = [];
        var cz = [];
        ace.ajaxGet("/course/read", function (data) {
            //加载设备id渲染在下拉框
            $(data).each(function (i, v) {
                if (v.parentId === 0) {
                    fac.push(v);
                } else {
                    //课程数据
                    course.push(v);
                }
            });
            //增加设备
            ace.select_facility[0].options[0] = new Option('请选择设备', '')
            $(fac).each(function (i, v) {
                ace.select_facility[0].options[i + 1] = new Option(v.name, v.id);
            });


            //设备变化
            ace.select_facility.on('change', function () {
                var that = $(this);
                //设备id
                var val = that.val();
                if (val === '') {
                    ace.select_curriculum[0].options[0] = new Option('请选择课程', '');
                } else {
                    $(course).each(function (i, v) {
                        //判断设备在课程的parent里面的位置并进行数据重组
                        if (+val === v.parentId) {
                            cz.push(v);
                        }
                    })
                    ace.select_curriculum[0].options[0] = new Option('请选择课程', '')
                    //增加相应课程类目
                    $(cz).each(function (i, v) {
                        ace.select_curriculum[0].options[i + 1] = new Option(v.name, v.id);
                    });
                }
                cz = [];
            })
        })


        //课程变化
        var options = [
            {"data": "id"},
            {"data": "name"},
            {
                "data": "name",
                "render": function (data, type, full, set) {
                    var logins = JSON.parse(localStorage.getItem("login"));
                    var a = logins.name;
                    return a;
                }
            },
            {
                "data": "operationScore",
                "render": function (data, type, full, set) {
                    if (data === 0) {
                        return ""
                    } else {
                        return data;
                    }
                }
            },
            {
                "data": "chooseScore",
                "render": function (data, type, full, set) {
                    if (data === 0) {
                        return ""
                    } else {
                        return data;
                    }
                }
            },
            {
                "data": "drawTime",
                "render": function (data, type, full, set) {
                    if (data === null) {
                        return ""
                    } else {
                        return data;
                    }
                }
            },
            {
                "data": "submitTime",
                "render": function (data, type, full, set) {
                    if (data === null) {
                        return ""
                    } else {
                        return data;
                    }
                }
            },
            {
                "data": "",
                "render": function (data, type, full, set) {
                    /*返回的数据拼接*/
                    if (data ===) {
                        return "<button type='button' class='btn1 course_bj notazirez'>开始考试</button>"

                    } else {
                        return false
                    }
                }
            }
        ];
        ace.ajaxGet("/paper/tests", function (data) {
            var paperId = [];
            $(data).each(function (i, v) {
                //模拟试卷
                if (v.paperType === 2) {
                    paperId.push(v);
                }
            });
            if (paperId.length === 0) {
                $("#basic-table").hide();
                $("#basic-table_wrapper").hide();
                $(".section-foot").show();
                return false
            } else {
                mo.datatables(paperId, options, [2, 3, 4, 5], function (data) {

                    //点击编辑
                    var aa1 = '';
                    var aa2 = '';
                    window.aa5 = '';
                    //开始考试
                    $('.notazirez').click(function () {
                        aa1 = $(this).parent().parent().children().eq(0).text();
                        $(data.aoData).each(function (i, v) {
                            if (+aa1 === v._aData.id) {
                                localStorage.setItem("moniOnlies", JSON.stringify(aa1));
                            }
                        })
                        window.location.href = "stu_moni_ceshi.html"
                    });


                });
            }


        })

        //课程进行数据变化
        ace.select_curriculum.on('change', function () {
            var that = $(this);
            var val = that.val();

            var dataset = {
                "id": val
            };
            //根据课程id查询当前模拟试卷
            //数据重新加载
            ace.ajaxPost("/questions/readByName", dataset, function (data) {

            })
            if (val === '') {
                $("#basic-table").hide();
                $("#basic-table_wrapper").hide();
                $(".section-foot").show();
            } else {
                mo.tables();
                $("#basic-table").show();
                $("#basic-table_wrapper").show();
                $(".section-foot").hide();
            }

            ace.ajaxPost(url, dataset, function (data) {
                //加载到页面上
                if (data === '') {

                }

            });
        });


        $("#test_button").click(function () {
            var facility = $("#facility").val();
            var course = $("#curriculum").val();
            if (facility === "" || course === '') {
                $('#error-modal2').modal();

            } else {
                var dataset = {
                    "id": course
                }
                ace.ajaxPost("/paper/draw", dataset, function (data) {
                    if (data.type === 0) {
                        location.href = "";
                    } else {
                        $(".section-foot").show();
                        $("#basic-table").hide();
                        $("#basic-table_wrapper").hide();
                        $("#error-modal").modal();
                    }
                })

            }

        })

    })
</script>
</html>