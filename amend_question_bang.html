<!doctype html>
<html lang="en" class="fixed" style='overflow: hidden'>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <title>三门核电有限公司三门数字化仿真检修平台</title>
    <link rel="stylesheet" type="text/css" href="stylesheets/css/bootstrap-3.3.4.css">
    <link rel="stylesheet" type="text/css" href="stylesheets/css/font-awesome.min.css">
    <link rel="stylesheet" href="stylesheets/css/vendor/animate.css/animate.css">
    <link rel="stylesheet" href="stylesheets/css/vendor/toastr/toastr.min.css">
    <link rel="stylesheet" href="stylesheets/css/vendor/magnific-popup/magnific-popup.css">
    <link rel="stylesheet" href="stylesheets/css/vendor/data-table/media/css/dataTables.bootstrap.min.css">
    <link rel="stylesheet" href="stylesheets/css/subject.css">
    <link rel="stylesheet" href="stylesheets/css/course.css">
</head>
<style>
    .steam_shiti1, #remove_checked, #remove_checked1 {
        display: none;
    }

    .span_one1, .span_one2, .span_one3, .span_one4 {
        display: none;
    }
</style>
<!--[if lt IE 8]>
<script type="text/javascript" src="javascripts/html5.js"></script>
<script type="text/javascript" src="javascripts/respond.js"></script>
<![endif]-->

<body onselectstart="return false">
<!--点击显示大的图片-->
<div class="big_da">
    <i class="fa  fa-close click_close" aria-hidden="true"></i>
    <img style="width: 50%;"
         src="http://pic.qiantucdn.com/58pic/16/40/37/22X58PICtFy.jpg!/fw/300/clip/0x400a0a0/format/webp" alt="">
</div>
<!--记载过程中的loading-->
<div class="text-center">
<span class='text-center shuju-tishi shuju-tishi1' style='color:white;display: none;'>
</span>
    <span class='text-center shuju-tishi shuju-tishi2' style='background-color:red;color:white;display: none;'>
</span>
</div>
<div class="modal fade" id="sm-modal" tabindex="-1" role="dialog"
     aria-labelledby="modal-default-label" style="display: none; padding-right: 16px;">
    <div class="modal-dialog modal-md" role="document">
        <div class="modal-content">
            <div class="modal-header state modal-primary">
                <button type="button" class="close" data-dismiss="   modal" aria-label="Close"><span
                        aria-hidden="true">×</span></button>
                <h4 class="modal-title" id="modal-large-label">添加岗位</h4>
            </div>
            <div class="modal-body modal-timu">
                <div class="form-group">
                    <!--岗位-->
                    <label class="control-label">请选择相应的部门及专业:</label>
                    <div id="area" class="area"></div>
                </div>
                <div class="form-group">
                    <label for="station1" class="control-label">岗位:</label>
                    <input type="text" class="form-control" id="station1">
                </div>
                <div class="form-group">
                    <!--身份-->
                    <label class="control-label">岗位备注:</label>
                    <textarea style='max-width: 568px;' class="form-control"
                              id="station2"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                        <span class="password-yanzheng pull-left warm-xinxi2"
                              style="display: none;line-height: 35px;"><i class="fa fa-info-circle fa-lg"></i>&nbsp;&nbsp;请将空白部分补充完整</span>
                <button type="button" id="station" class="btn btn-primary" data-dismiss="modal">确认添加
                </button>
                <button type="button" class="btn  btn-danger" data-dismiss="modal">关闭</button>
            </div>
        </div>
    </div>
</div>
<!-- 整体页面 -->
<div class="wrap">
    <!--顶部栏-->
    <div class="page-header">
        <div class="leftside-header">
            <div id="menu-toggle" class="visible-xs toggle-left-sidebar" data-toggle-class="left-sidebar-open"
                 data-target="html">
                <i class="fa fa-bars" aria-label="Toggle sidebar"></i>
            </div>
        </div>
        <div class="rightside-header">
            <div class="header-middle"></div>
            <!-- 红点信息 -->
            <div class="header-section">
                <span>你好,管理员!</span>

            </div>
            <div class="header-separator"></div>
            <div class="header-section" style="margin-right: 50px;">
                <a href="login.html" style='display: inline-block;transform:translatey(1px);'><i
                        class="fa fa-sign-out log-out" aria-hidden="true"></i>注销</a>
            </div>
        </div>
    </div>
    <div class="page-body">
        <!--左侧栏-->
        <div class="left-sidebar">
            <div id="left-nav" class="nano">
                <div class="nano-content" style="right: 0 !important;">
                    <nav>
                        <ul class="nav" id="main-nav">
                            <li>
                                <a href='section.html'>
                                    <i class="fa fa-university" aria-hidden="true"></i>部门管理
                                </a>
                            </li>
                            <li>
                                <a href='facility.html'>
                                    <i class="fa fa-diamond" aria-hidden="true"></i>设备管理
                                </a>
                            </li>
                            <li class="">
                                <a href='course.html'>
                                    <i class="fa fa-book" aria-hidden="true"></i>课程管理
                                </a>
                            </li>
                            <li class="">
                                <a href='model.html'>
                                    <i class="fa fa-pie-chart" aria-hidden="true"></i>模型管理
                                </a>
                            </li>
                            <li class="">
                                <a href='project.html'>
                                    <i class="fa fa-wrench" aria-hidden="true"></i>检修规划管理
                                </a>
                            </li>
                            <li class=" has-child-item open-item">
                                <a>
                                    <i class='fa fa-bar-chart' aria-hidden="true"></i>
                                    <span>考试管理</span>
                                </a>
                                <ul class="nav child-nav level-1">
                                    <li class="active-item"><a href='question_bang.html'>题库管理</a></li>
                                    <li><a href='test.html'>试卷管理</a></li>
                                </ul>
                            </li>
                            <li class=" has-child-item close-item">
                                <a>
                                    <i class='fa fa-users' aria-hidden="true"></i>
                                    <span>员工管理</span>
                                </a>
                                <ul class="nav child-nav level-1">
                                    <li><a href=''>账号管理</a></li>
                                    <li><a href=''>所属部门</a></li>
                                    <li><a href=''>所属角色</a></li>
                                </ul>
                            </li>
                            <li class=""><a href='pemanage.html'> <i class="fa fa-edit" aria-hidden="true"></i>PEInside管理
                            </a></li>
                            <li class=""><a href=''> <i class="fa fa-trash" aria-hidden="true"></i>清理临时文件 </a></li>
                            <li class=""><a href='download.html'> <i class="fa fa-download" aria-hidden="true"></i>软件下载
                            </a></li>
                        </ul>

                    </nav>
                </div>
            </div>
        </div>
        <!--右侧栏-->
        <div class="content ">
            <div class="content-header content-header1 margin-left-click"
                 style='height: 100%;background-color: #f3f3f4;padding: 20px;'>
                <!--主体-->

                <div class="section animated fadeInRight">
                    <div class="section-head">
                        <h2>题目管理</h2>
                    </div>
                    <!--中间区域独立模块-->
                    <div class="Add_course">
                        <div class="Add_course_head">
                            <i class="fa fa-ellipsis-v "></i>编辑题目
                        </div>
                        <h3>题目信息</h3>
                        <form id="forms" enctype="multipart/form-data" name="forms">
                            <div class="container-fluid">
                                <div class="clearfix">
                                    <div class="col-xs-3 text-right">
                                        类型
                                    </div>
                                    <div class="col-xs-9">
                                        <select name="type" id="steam_shiti" class="form-control">
                                            <option value="0">单选题</option>
                                            <option value="1">操作题</option>
                                            <option value="2">问答题</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="clearfix">
                                    <div class="col-xs-3 text-right">
                                        所属课程
                                    </div>
                                    <div class="col-xs-9">
                                        <select name="courseId" id="courseId" class="form-control">

                                        </select>
                                    </div>
                                </div>
                                <div class="clearfix">
                                    <div class="col-xs-3 text-right">
                                        题干
                                    </div>
                                    <div class="col-xs-9">
                                        <textarea name="body" id="bodyText" class="form-control"
                                                  style="max-width: 100%;min-height: 84px;"></textarea>
                                    </div>
                                </div>
                                <!--单选题-->
                                <div class="steam_shiti0">
                                    <div class="clearfix">
                                        <div class="col-xs-3 text-right">
                                            备选答案
                                        </div>
                                        <div class="col-xs-7" id="createHTml">

                                        </div>
                                        <div class="col-xs-2">
                                            <button type='button' class='btn1  color_ora' id="remove_checked"
                                                    style="padding: 6px 20px;">删除备选项
                                            </button>

                                        </div>
                                    </div>
                                    <div class="clearfix">
                                        <div class="col-xs-3 text-right">
                                            添加选项
                                        </div>
                                        <div class="col-xs-7">

                                        <textarea name="" class="form-control tive_text"
                                                  style="max-width: 100%;"></textarea>
                                        </div>
                                        <div class="col-xs-2">
                                            <button type='button' class='btn1  color_ql' id="add_checked"
                                                    style="padding: 6px 20px;">添加
                                            </button>

                                        </div>
                                    </div>

                                    <div class="clearfix">
                                        <div class="col-xs-3 text-right">
                                            正确选项
                                        </div>
                                        <div class="col-xs-9" id="selecteds">

                                        </div>
                                    </div>
                                </div>
                                <!--操作题-->
                                <div class="steam_shiti1">
                                    <div class="clearfix">
                                        <div class="col-xs-3 text-right">
                                            操作步骤
                                        </div>
                                        <div class="col-xs-7" id="createHTml1">

                                        </div>
                                        <div class="col-xs-2">
                                            <button type='button' class='btn1  color_ora' id="remove_checked1"
                                                    style="padding: 6px 20px;">删除步骤
                                            </button>

                                        </div>
                                    </div>
                                    <div class="clearfix">
                                        <div class="col-xs-3 text-right">
                                            添加步骤
                                        </div>
                                        <div class="col-xs-7">

                                        <textarea name="" class="form-control tive_text1"
                                                  style="max-width: 100%;"></textarea>
                                        </div>
                                        <div class="col-xs-2">
                                            <button type='button' class='btn1  color_ql' id="add_checked1"
                                                    style="padding: 6px 20px;">添加
                                            </button>

                                        </div>
                                    </div>

                                    <div class="clearfix">
                                        <div class="col-xs-3 text-right">
                                            题目序号
                                        </div>
                                        <div class="col-xs-9" id="selecteds1">
                                            <input type="number" min="0" class="form-control" name="modelId">
                                        </div>
                                    </div>
                                </div>
                                <div class="clearfix">
                                    <div class="col-xs-3 text-right">
                                        题目图像
                                    </div>
                                    <div class="col-xs-9">

                                        <input type="file" name="image" id="modelImg" accept="image/*">
                                        <div class="progress progress-striped" style="margin-top: 20px;">
                                            <div class="progress-bar progress-bar-success text-center"
                                                 role="progressbar"
                                                 aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"
                                                 style="width: 0%;" id="Progress">
                                                <span class="sr-only"
                                                      style='clip: inherit !important;width:  61px;height: 22px;position: inherit;'></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="clearfix">
                                    <div class="col-xs-3 text-right">
                                        图像预览
                                    </div>
                                    <div class="col-xs-9">

                                        <img id="model_img" src="./images/model.jpg" alt="暂无图像">
                                    </div>
                                </div>
                            </div>
                            <input type="hidden" name="id" value="">
                            <input type="hidden" id="images" name="image" value="">
                        </form>

                        <div class="Add_course_bottom text-center">
                            <button type='button' class='btn1 course_bj notazirez'>添加</button>
                            <button type='button' class='btn1 course_remove removeShuju'>关闭</button>
                        </div>
                    </div>
                </div>
            </div>
            <a href="#" class="scroll-to-top"><i class="fa fa-angle-double-up"></i></a>
        </div>
    </div>
</div>


<!--警告信息-->
<div class="modal fade" id="error-modal2" tabindex="-1" role="dialog"
     aria-labelledby="modal-error-label"
     style="display: none;">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header state modal-warning">
                <button type="button" class="close" data-dismiss="modal"
                        aria-label="Close"><span
                        aria-hidden="true">×</span></button>
                <h4 class="modal-title"><i class="fa fa-warning"></i>提示
                </h4>
            </div>
            <div class="modal-body">
                <span class="span_one1">需要添加题干</span>
                <span class="span_one2">需要添加备选项</span>
                <span class="span_one3">需要添加正确答案</span>
                <span class="span_one4">需要输入题目序号,请为正整数</span>
            </div>
            <div class="modal-footer">
                <!--确认删除-->
                <button type="button" class="btn " data-dismiss="modal">
                    确定
                </button>
            </div>
        </div>
    </div>
</div>


<!--培训提示信息-->
<div class="modal fade" id="error-modal" tabindex="-1" role="dialog"
     aria-labelledby="modal-error-label"
     style="display: none;">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header state modal-primary">
                <button type="button" class="close" data-dismiss="modal"
                        aria-label="Close"><span
                        aria-hidden="true">×</span></button>
                <h4 class="modal-title"><i class="fa fa-warning"></i>提示
                </h4>
            </div>
            <div class="modal-body">
                <span class="error-span1">信息保存成功</span>

            </div>
            <div class="modal-footer">
                <!--确认删除-->
                <button type="button" class="btn " data-dismiss="modal">
                    关闭
                </button>
            </div>
        </div>
    </div>
</div>

<script src="javascripts/jquery.1.10.2.js"></script>
<script src="stylesheets/css/vendor/bootstrap/js/bootstrap.min.js"></script>
<script src="stylesheets/css/vendor/nano-scroller/nano-scroller.js"></script>
<script src="javascripts/template-script.min.js"></script>
<script src="javascripts/template-init.min.js"></script>
<script src="stylesheets/css/vendor/media/js/jquery.dataTables.min.js"></script>
<script src="stylesheets/css/vendor/media/js/dataTables.bootstrap.min.js"></script>
<script src='javascripts/course.js'></script>
<script type="text/javascript" src='javascripts/sea.js'></script>
<script type="text/javascript">
    localStorage.setItem('arrCheckeds', JSON.stringify(""));

    seajs.use('./javascripts/common.js', function (main) {
        var ace = new main.comm();
        ace.localHref(".removeShuju", "./question-bang.html");
        ace.change("#modelImg", "#model_img");
        ace.filesUpload('modelImg', 'Progress', '.sr-only');
        //改变删除隐藏域
        ace.butChange("#modelImg", function () {
            $("##images").remove();
        })

        var fac = [];
        //加载所属课程中的内容
        ace.ajaxGet("/course/read", function (data) {
                //将课程进行筛选
                $(data).each(function (i, v) {
                    if (v.parentId !== 0) {
                        fac.push(v);
                    }
                })
                $(fac).each(function (i, v) {
                    //加载数据
                    $("#courseId")[0].options[i] = new Option(v.name, v.id);
                })
            }
        )

    })
    $(function () {
        var mo = new models();
        var forms = document.forms;

        //获取到比较的数据值
        var question = JSON.parse(localStorage.getItem("question"));
        //传值id,进行数据获取，并进行加载,应该得到题目类型，题目选项
        var optionsa = question.answer;
        // var zm = ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K", "L", "M", "N", "O", "P", "Q", "R", "S", "T", "U", "V", "X", "Y", "Z"];
        //
        // $(question).each(function (i, vv) {
        //     $(zm).each(function (i, v) {
        //         var newWord = "answer" + v;
        //         if (vv[newWord] !== undefined) {
        //             optionsa.push(vv[newWord]);
        //         } else {
        //             return false
        //         }
        //     })
        // });
        //获取编辑信息
        $("#bodyText").val(question.body);
        optionsa.length > 0 ? $('#remove_checked').show() : $('#remove_checked').hide();
        localStorage.setItem('arrCheckeds', JSON.stringify(optionsa));
        if (question.type === 0) {

            var htmll = mo.createHtml(optionsa, 0);
            //渲染选项内容以及选择样式
            $("#createHTml").html(htmll.html);
            $('#selecteds').html(htmll.radios);

        } else if (question.type === 1) {
            var htmll = mo.createHtml(optionsa, 1);
            $('#createHTml1').html(htmll.html);
            $(".steam_shiti0").hide();
            $(".steam_shiti1").show();

        } else if (question.type === 2) {
            $(".steam_shiti0").hide();
            $(".steam_shiti1").hide();
        }

        forms.id.value = question.id;//题目id
        forms.modelId.value = question.modelId;//题目序号
        mo.selected("#courseId", question.courseId);//所属课程选中
        mo.selected("#steam_shiti", question.type);//类型
        $("#images").val(question.image);//图片隐藏
        //题目正确选项选中
        $("input[name='right']").each(function (i, v) {
            //为每个选项的名称
            if ($(v).attr("data-en") === question.right) {
                $(v).prop("checked", true);
                return false
            }
        })

        //为一下的封装
//        //选中判断
//        $("#courseId").children().each(function (i, v) {
//            if ($(v).text().indexOf(question.courseName) !== -1) {
//                $(v).prop('selected', true);
//                return false
//            }
//        })
//        $("#steam_shiti").children().each(function (i, v) {
//            if ($(v).val().indexOf(question.type) !== -1) {
//                $(v).prop('selected', true);
//                return false
//            }
//        })

        $('.notazirez').click(function () {
            if ($("#bodyText").val() === "" || $("#bodyText").val() === undefined) {
                $(".span_one1").show();
                $(".span_one2").hide();
                $(".span_one3").hide();
                $("#error-modal2").modal();
                return false
            }

            //单选题类型
            var qub = 0;
            if ($("#steam_shiti").val() === "0") {
                if ($("input[name='answer']")[0] === undefined) {
                    $(".span_one2").show();
                    $(".span_one1").hide();
                    $(".span_one3").hide();
                    $("#error-modal2").modal();
                    return false
                }
                $("input[name='right']").each(function (i, v) {
                    if ($(v).is(":checked")) {
                        qub = 1;
                    }
                })
                if (qub !== 1) {
                    $(".span_one3").show();
                    $(".span_one2").hide();
                    $(".span_one4").hide();
                    $(".span_one1").hide();
                    $("#error-modal2").modal();
                    return false
                }
                $(".steam_shiti1").remove();

            } else if ($("#steam_shiti").val() === "1") {
                //操作题类型
                if ($("#createHTml1 input[name='answer']")[0] === undefined) {
                    $(".span_one2").show();
                    $(".span_one1").hide();
                    $(".span_one3").hide();
                    $("#error-modal2").modal();
                    return false
                }
                if ($("input[name='modelId']").val() === "") {
                    $(".span_one4").show();
                    $(".span_one1").hide();
                    $(".span_one3").hide();
                    $(".span_one2").hide();
                    $("#error-modal2").modal();
                    return false
                }
                $(".steam_shiti0").remove();

            } else if ($("#steam_shiti").val() === "2") {
                //问答题类型
                $(".steam_shiti0").remove();
                $(".steam_shiti1").remove();
            }
            mo.numcs("/questions/update", "forms", "", function () {

                $("#error-modal").modal();
                window.location.href = "question_bang.html";
            })
        });

        //点击备选项添加
        $("#add_checked").click(function () {
            $('#remove_checked').show();
            var val = $('.tive_text').val();
            var arr = [];
            arr.push(val);
            var arrs = JSON.parse(localStorage.getItem('arrCheckeds'));
            localStorage.setItem('arrCheckeds', JSON.stringify(arr));
            if (arrs.length >= 1) {
                arr = arrs;
                arr.push(val);
                localStorage.setItem('arrCheckeds', JSON.stringify(arr));
            }
            var htmll = mo.createHtml(arr, 0);
            $("#createHTml").html(htmll.html);
            $('#selecteds').html(htmll.radios)
            $('.tive_text').val("");
        })
        //删除备选项
        $("#remove_checked").click(function () {
            var inputSelect = $('#createHTml input[name="answer"]');
            var inputRadios = $('#selecteds input[name="right"]');
            var arrs = JSON.parse(localStorage.getItem('arrCheckeds'));
            if (arrs.length === 0) {
                $(this).hide();
            }
            inputSelect.each(function (i, v) {
                if ($(v).is(':checked')) {
                    $(v).parent().next().remove();
                    $(v).parent().remove();
                    $(inputRadios[i]).parent().next().remove();
                    $(inputRadios[i]).parent().remove();
                    //同时删除数据并进行渲染
                    arrs = mo.removeArray(arrs, $(v).val());
                    localStorage.setItem('arrCheckeds', JSON.stringify(arrs));
                }

            })
            if (arrs.length === 0) {
                $(this).hide()
            }
            var htmll = mo.createHtml(arrs, 0);
            $("#createHTml").html(htmll.html);
            $('#selecteds').html(htmll.radios)

        })
        //点击切换题目类型,界面显示
        $('#steam_shiti').on('change', function () {
            console.log($(this).val());
            switch ($(this).val()) {
                case "0":
                    $('.steam_shiti0').show();
                    $('.steam_shiti1').hide();
                    var arrs = JSON.parse(localStorage.getItem('arrCheckeds'));
                    var htmll = mo.createHtml(arrs, 0);
                    $('#createHTml').html(htmll.html);
                    $('#selecteds').html(htmll.radios);
                    arrs.length > 0 ? $('#remove_checked').show() : $('#remove_checked').hide();
                    break;
                case "1"://操作题
                    $('.steam_shiti0').hide();
                    $('.steam_shiti1').show();
                    var arrs = JSON.parse(localStorage.getItem('arrCheckeds'));
                    arrs.length > 0 ? $('#remove_checked1').show() : $('#remove_checked1').hide();
                    var htmll = mo.createHtml(arrs, 1);
                    $('#createHTml1').html(htmll.html);
                    break;
                default://问答题
                    $('.steam_shiti0').hide();
                    $('.steam_shiti1').hide();
                    break;
            }
        })

        //操作题添加
        $('#add_checked1').on('click', function () {
            $('#remove_checked1').show()
            var val = $('.tive_text1').val();
            var arr = [];
            arr.push(val);
            var arrs = JSON.parse(localStorage.getItem('arrCheckeds'));
            localStorage.setItem('arrCheckeds', JSON.stringify(arr));
            if (arrs.length >= 1) {
                arr = arrs;
                arr.push(val);
                localStorage.setItem('arrCheckeds', JSON.stringify(arr));
            }
            var htmll = mo.createHtml(arr, 1);
            $("#createHTml1").html(htmll.html);
            $('.tive_text1').val("");
        })

        //删除备选项
        $("#remove_checked1").click(function () {
            var inputSelect = $('#createHTml1 input[name="answer"]');
            var arrs = JSON.parse(localStorage.getItem('arrCheckeds'));
            inputSelect.each(function (i, v) {
                if ($(v).is(':checked')) {
                    $(v).parent().next().remove();
                    $(v).parent().remove();
                    //同时删除数据并进行渲染
                    arrs = mo.removeArray(arrs, $(v).val());
                    localStorage.setItem('arrCheckeds', JSON.stringify(arrs));
                }

            })
            if (arrs.length === 0) {
                $(this).hide();
            }
            var htmll = mo.createHtml(arrs, 1);
            $("#createHTml1").html(htmll.html);

        })
    })
</script>
</body>
</html>