<!doctype html>
<html lang="en" class="fixed" style='overflow: hidden'>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <title>三门核电有限公司三门数字化仿真检修平台</title>
    <link rel="stylesheet" type="text/css" href="stylesheets/css/bootstrap-3.3.4.css">
    <link rel="stylesheet" type="text/css" href="stylesheets/css/font-awesome.min.css">
    <link rel="stylesheet" href="stylesheets/css/vendor/animate.css/animate.css">
    <link rel="stylesheet" href="stylesheets/css/vendor/toastr/toastr.min.css">
    <link rel="stylesheet" href="stylesheets/css/vendor/magnific-popup/magnific-popup.css">

    <link rel="stylesheet" href="stylesheets/css/vendor/data-table/media/css/dataTables.bootstrap.min.css">
    <link rel="stylesheet" href="stylesheets/css/subject.css">
    <link rel="stylesheet" href="stylesheets/css/question-bank.css">
</head>
<style>
    .btn.btn-wide {
        transform: translatey(12px);
        margin-left: 20px;
    }

    .section-foot {
        margin: 20px;
        border-radius: 5px;
    }

    input[readonly="readonly"] {
        cursor: auto !important;
    }
</style>
<!--[if lt IE 9]>
<script type="text/javascript" src="javascripts/html5.js"></script>
<script type="text/javascript" src="javascripts/respond.js"></script>
<![endif]-->
<style>
    #basic-table_wrapper {
        margin-top: 20px;
    }
</style>
<body onselectstart="return false">

<!--记载过程中的loading-->
<div class="text-center">
<span class='text-center shuju-tishi shuju-tishi1' style='color:white;display: none;'>
</span>
    <span class='text-center shuju-tishi shuju-tishi2' style='background-color:red;color:white;display: none;'>
</span>
</div>
<!-- 整体页面 -->
<div class="wrap">
    <!--顶部栏-->
    <div class="page-header">
        <div class="leftside-header">
            <div id="menu-toggle" class="visible-xs toggle-left-sidebar" data-toggle-class="left-sidebar-open"
                 data-target="html">
                <i class="fa fa-bars" aria-label="Toggle sidebar"></i>
            </div>
        </div>
        <div class="rightside-header">
            <div class="header-middle"></div>
            <!-- 红点信息 -->
            <div class="header-section">
                <a href="" class="usname_local"  onload="loginas()">你好</a>
            </div>
            <div class="header-separator"></div>
            <div class="header-section" style="margin-right: 50px;">
                <a href="login.html" style='display: inline-block;transform:translatey(1px);'><i
                        class="fa fa-sign-out log-out" aria-hidden="true"></i>注销</a>
            </div>
        </div>
    </div>
    <div class="page-body">
        <!--左侧栏-->
        <div class="left-sidebar">
            <div id="left-nav" class="nano">
                <div class="nano-content" style="right: 0 !important;">
                    <nav>
                        <ul class="nav" id="main-nav">
                            <li>
                                <a href='section.html'>
                                    <i class="fa fa-university" aria-hidden="true"></i>部门管理
                                </a>
                            </li>
                            <li  class="">
                                <a href='facility.html'>
                                    <i class="fa fa-diamond" aria-hidden="true"></i>设备管理
                                </a>
                            </li>
                            <li class="">
                                <a href='course.html'>
                                    <i class="fa fa-book" aria-hidden="true"></i>课程管理
                                </a>
                            </li>
                            <li class="">
                                <a href='model.html'>
                                    <i class="fa fa-pie-chart" aria-hidden="true"></i>模型管理
                                </a>
                            </li>
                            <li class="">
                                <a href='project.html'>
                                    <i class="fa fa-wrench" aria-hidden="true"></i>检修规划管理
                                </a>
                            </li>
                            <li class=" has-child-item open-item">
                                <a >
                                    <i class='fa fa-bar-chart' aria-hidden="true"></i>
                                    <span>考试管理</span>
                                </a>
                                <ul class="nav child-nav level-1">
                                    <li><a href='question_bang.html'>题库管理</a></li>
                                    <li class="active-item"><a href='test.html'>试卷管理</a></li>
                                </ul>
                            </li>
                            <li class=" has-child-item close-item">
                                <a>
                                    <i class='fa fa-users' aria-hidden="true"></i>
                                    <span>员工管理</span>
                                </a>
                                <ul class="nav child-nav level-1">
                                    <li><a href='people.html'>账号管理</a></li>
                                    <li><a href='add_people_select.html'>所属部门</a></li>
                                    <li><a href='add_people_student.html'>所属角色</a></li>
                                </ul>
                            </li>
                            <li class=""><a href='pemanage.html'> <i class="fa fa-edit" aria-hidden="true"></i>PEInside管理
                            </a></li>
                            <li class=""><a href='admin_clear.html'> <i class="fa fa-trash" aria-hidden="true"></i>清理临时文件 </a></li>
                            <li class=""><a href='download.html'> <i class="fa fa-download" aria-hidden="true"></i>软件下载
                            </a></li>
                        </ul>

                    </nav>
                </div>
            </div>
        </div>
        <!--右侧栏-->
        <div class="content  ">
            <form name="formw" id="formw">
                <div class="content-header content-header1 margin-left-click"
                     style='height: 100%;background-color: #f3f3f4;padding: 20px;'>
                    <!--主体-->
                    <div class="container-fluid">
                        <div class="section animated fadeInRight">
                            <div class="section-head">
                                <h2>题库管理</h2>
                            </div>
                            <div class="section-body clearfix">
                                <!--主体结构-->
                                <div>
                                    设备
                                    <input type="text" readonly="readonly" id="facility" value="">

                                    课程
                                    <input type="text" readonly="readonly" id="curriculum" value="">
                                    试卷名称
                                    <input type="text" name="test_name" id="formw_test" value="">


                                </div>
                                <span id="test_button" class=" btn btn-wide btn-success" title='保存试卷'>保存试卷</span>
                                <span id="test_close" class=" btn btn-wide  btn-info" title='关闭'>关闭</span>
                            </div>
                            <div class=" clearfix">
                                <!--表格数据-->
                                <table id="basic-table"
                                       class="data-table table table-striped nowrap table-hover" cellspacing="0"
                                       width="100%">
                                    <thead>
                                    <tr>
                                        <th>标识</th>
                                        <th>选中</th>
                                        <th>题型</th>
                                        <th>题干</th>
                                        <th>创建时间</th>
                                    </tr>
                                    </thead>
                                    <tbody class="tbodya">
                                    <!--占位符-->
                                    </tbody>
                                </table>
                            </div>

                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<!--培训提示信息-->
<div class="modal fade" id="error-modal" tabindex="-1" role="dialog"
     aria-labelledby="modal-error-label"
     style="display: none;">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header state modal-primary">
                <button type="button" class="close" data-dismiss="modal"
                        aria-label="Close"><span
                        aria-hidden="true">×</span></button>
                <h4 class="modal-title"><i class="fa fa-warning"></i>提示
                </h4>
            </div>
            <div class="modal-body">
                <span class="error-span1">信息保存成功</span>

            </div>
            <div class="modal-footer">
                <!--确认删除-->
                <button type="button" class="btn " data-dismiss="modal">
                    关闭
                </button>
            </div>
        </div>
    </div>
</div>


<!--警告信息-->
<div class="modal fade" id="error-modal2" tabindex="-1" role="dialog"
     aria-labelledby="modal-error-label"
     style="display: none;">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header state modal-warning">
                <button type="button" class="close" data-dismiss="modal"
                        aria-label="Close"><span
                        aria-hidden="true">×</span></button>
                <h4 class="modal-title"><i class="fa fa-warning"></i>提示
                </h4>
            </div>
            <div class="modal-body">
                请输入试卷名称
            </div>
            <div class="modal-footer">
                <!--确认删除-->
                <button type="button" class="btn " data-dismiss="modal">
                    确定
                </button>
            </div>
        </div>
    </div>
</div>

<script src="javascripts/jquery.1.10.2.js"></script>
<script src="stylesheets/css/vendor/bootstrap/js/bootstrap.min.js"></script>
<script src="stylesheets/css/vendor/nano-scroller/nano-scroller.js"></script>
<script src="javascripts/template-script.min.js"></script>
<script src="javascripts/template-init.min.js"></script>
<script src="stylesheets/css/vendor/toastr/toastr.min.js"></script>
<script src="stylesheets/css/vendor/media/js/jquery.dataTables.min.js"></script>
<script src="stylesheets/css/vendor/media/js/dataTables.bootstrap.min.js"></script>
<script src="stylesheets/css/vendor/magnific-popup/jquery.magnific-popup.min.js"></script>
<script type="text/javascript" src='javascripts/course.js'></script>
<script type="text/javascript" src='javascripts/sea.js'></script>
<script type="text/javascript">
    seajs.use('./javascripts/common.js', function (main) {
        var ace = new main.comm();
        var mo = new models();

        ace.localHref("#test_close", "test.html");
        // window.seleIds = [];
        var locals = JSON.parse(localStorage.getItem("tests"));

        $('#facility').val(locals.machineName);
        $('#curriculum').val(locals.courseName);
        $("#formw_test").val(locals.name);
        //同时传试卷id,获取选中的题目的id值进行标注，同时上传id进行保存
        window.seleIds = locals.questionId;

        var dataset = {
            "id": locals.CourseId
        }
        //根据课程查询全部试题
        ace.ajaxForm("/questions/readByName", dataset, function (datas) {
            var options = [
                {"data": "id"},
                {
                    "data": "type",
                    "render": function (data, type, full, set) {
                        var inpu = "<label style='width: 100%;cursor:pointer'>" +
                            "<input name='id' type='checkbox' " +
                            "class='checkSelect checkedSe" +
                            full.id + "' value='" + full.id + "'>" +
                            "</label>"
                        return inpu
                    }
                },
                {
                    "data": "type",
                    "render": function (data, type, full, set) {
                        if (data === 0) {
                            return "单选题"
                        } else if (data === 1) {
                            return "操作题"
                        } else if (data === 2) {
                            return "问答题"
                        }

                    }
                },
                {
                    "data": "body",
                    "render": function (data, type, full, set) {
                        var substrs = full.body.substr(0, 18) + "...";
                        return substrs;
                    }
                },
                {"data": "createDate"}
            ];

            //数据处理并进行渲染
            mo.datatables(datas, options, [0, 1, 2, 3, 4], function (data) {

                //回掉函数获取加载的数据信息
                $(".checkSelect").on("change", function () {
                    var vals = $(this).val();
                    if ($(this).is(':checked')) {
                        if (window.seleIds.join().indexOf(vals) === -1) {
                            window.seleIds.push(vals);
                        }

                    } else {
                        window.seleIds.forEach(function (v, i) {
                            if (v === vals) {
                                window.seleIds.splice(i, 1);
                            }
                        })

                    }
                })

                window.seleIds.forEach(function (v, i) {
                    var num = ".checkedSe" + v;
                    $(num).prop('checked', true);
                })
            });

        })


        //保存数据
        $("#test_button").click(function () {
            var dataset = {
                "id": locals.id,
                "name": $("#formw_test").val(),
                "machineId": locals.machineId,
                "courseId": locals.courseId,
                "questionId": window.seleIds
            };

            if ($("#formw_test").val() === "") {
                $("#error-modal2").modal();
            } else {
                ace.ajaxPost("/paper/update", dataset, function () {
                    $("#error-modal").modal();
                    window.location.href = "test.html";

                });
            }
        })

    })
</script>
</body>
</html>